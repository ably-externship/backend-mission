import s from"autoprefixer";import e from"cssdb";import o from"fs";import t from"path";import r from"postcss-attribute-case-insensitive";import i from"css-blank-pseudo";import n from"postcss-color-functional-notation";import c from"postcss-color-hex-alpha";import a from"postcss-color-rebeccapurple";import p from"postcss-custom-media";import u from"postcss-custom-properties";import l from"postcss-custom-selectors";import m from"postcss-dir-pseudo-class";import f from"postcss-double-position-gradients";import d from"postcss-env-function";import b from"postcss-focus-visible";import g from"postcss-focus-within";import h from"postcss-font-variant";import y from"postcss-gap-properties";import w from"css-has-pseudo";import v from"postcss-image-set-function";import $ from"postcss-initial";import k from"postcss-lab-function";import O from"postcss-logical";import S from"postcss-media-minmax";import j from"postcss-nesting";import x from"postcss-overflow-shorthand";import E from"postcss-page-break";import P from"postcss-place";import M from"css-prefers-color-scheme";import _ from"postcss-pseudo-class-any-link";import q from"postcss-replace-overflow-wrap";import R from"postcss-selector-not";import A from"@csstools/postcss-is-pseudo-class";import F from"@csstools/postcss-hwb-function";import N from"postcss-opacity-percentage";import T from"postcss-clamp";import B from"@csstools/postcss-font-format-keywords";import U from"@csstools/postcss-normalize-display-values";import W from"browserslist";async function C(s,e,o,t){const r=function(s){return`:root {\n${Object.keys(s).reduce(((e,o)=>(e.push(`\t${o}: ${s[o]};`),e)),[]).join("\n")}\n}\n`}(o),i=function(s){return`${Object.keys(s).reduce(((e,o)=>(e.push(`@custom-media ${o} ${s[o]};`),e)),[]).join("\n")}\n`}(e),n=function(s){return`${Object.keys(s).reduce(((e,o)=>(e.push(`@custom-selector ${o} ${s[o]};`),e)),[]).join("\n")}\n`}(t),c=`${i}\n${n}\n${r}`;await z(s,c)}function I(s,e){return`\n\t${s}: {\n${Object.keys(e).reduce(((s,o)=>(s.push(`\t\t'${G(o)}': '${G(e[o])}'`),s)),[]).join(",\n")}\n\t}`}function V(s,e){return`export const ${s} = {\n${Object.keys(e).reduce(((s,o)=>(s.push(`\t'${G(o)}': '${G(e[o])}'`),s)),[]).join(",\n")}\n};\n`}function D(s,e){return Promise.all([].concat(e).map((async e=>{if(e instanceof Function)await e({customMedia:J(s.customMedia),customProperties:J(s.customProperties),customSelectors:J(s.customSelectors)});else{const o=e===Object(e)?e:{to:String(e)},r=o.toJSON||J;if("customMedia"in o||"customProperties"in o||"customSelectors"in o)o.customMedia=r(s.customMedia),o.customProperties=r(s.customProperties),o.customSelectors=r(s.customSelectors);else if("custom-media"in o||"custom-properties"in o||"custom-selectors"in o)o["custom-media"]=r(s.customMedia),o["custom-properties"]=r(s.customProperties),o["custom-selectors"]=r(s.customSelectors);else{const e=String(o.to||""),i=(o.type||t.extname(o.to).slice(1)).toLowerCase(),n=r(s.customMedia),c=r(s.customProperties),a=r(s.customSelectors);"css"===i&&await C(e,n,c,a),"js"===i&&await async function(s,e,o,t){const r=`module.exports = {${I("customMedia",e)},${I("customProperties",o)},${I("customSelectors",t)}\n};\n`;await z(s,r)}(e,n,c,a),"json"===i&&await async function(s,e,o,t){const r=`${JSON.stringify({"custom-media":e,"custom-properties":o,"custom-selectors":t},null,"  ")}\n`;await z(s,r)}(e,n,c,a),"mjs"===i&&await async function(s,e,o,t){const r=`${V("customMedia",e)}\n${V("customProperties",o)}\n${V("customSelectors",t)}`;await z(s,r)}(e,n,c,a)}}})))}function J(s){return Object.keys(s).reduce(((e,o)=>(e[o]=String(s[o]),e)),{})}function z(s,e){return new Promise(((t,r)=>{o.writeFile(s,e,(s=>{s?r(s):t()}))}))}function G(s){return s.replace(/\\([\s\S])|(')/g,"\\$1$2").replace(/\n/g,"\\n").replace(/\r/g,"\\r")}function H(){return{postcssPlugin:"postcss-system-ui-font",Declaration(s){L.test(s.prop)&&(s.value.includes(Q.join(", "))||(s.value=s.value.replace(X,Y)))}}}H.postcss=!0;const L=/(?:^(?:-|\\002d){2})|(?:^font(?:-family)?$)/i,K="[\\f\\n\\r\\x09\\x20]",Q=["system-ui","-apple-system","Segoe UI","Roboto","Ubuntu","Cantarell","Noto Sans","sans-serif"],X=new RegExp(`(^|,|${K}+)(?:system-ui${K}*)(?:,${K}*(?:${Q.join("|")})${K}*)?(,|$)`,"i"),Y=`$1${Q.join(", ")}$2`,Z={"css-blank-pseudo":"blank-pseudo-class","css-has-pseudo":"has-pseudo-class","css-prefers-color-scheme":"prefers-color-scheme-query","postcss-attribute-case-insensitive":"case-insensitive-attributes","postcss-clamp":"clamp","postcss-color-functional-notation":"color-functional-notation","postcss-color-hex-alpha":"hexadecimal-alpha-notation","postcss-color-rebeccapurple":"rebeccapurple-color","postcss-custom-media":"custom-media-queries","postcss-custom-properties":"custom-properties","postcss-custom-selectors":"custom-selectors","postcss-dir-pseudo-class":"dir-pseudo-class","postcss-double-position-gradients":"double-position-gradients","postcss-env-function":"environment-variables","postcss-focus-visible":"focus-visible-pseudo-class","postcss-focus-within":"focus-within-pseudo-class","postcss-font-format-keywords":"font-format-keywords","postcss-font-variant":"font-variant-property","postcss-gap-properties":"gap-properties","postcss-hwb-function":"hwb-function","postcss-image-set-function":"image-set-function","postcss-initial":"all-property","postcss-is-pseudo-class":"is-pseudo-class","postcss-lab-function":"lab-function","postcss-logical":"logical-properties-and-values","postcss-media-minmax":"media-query-ranges","postcss-nesting":"nesting-rules","postcss-normalize-display-values":"display-two-values","postcss-opacity-percentage":"opacity-percentage","postcss-overflow-shorthand":"overflow-property","postcss-page-break":"break-properties","postcss-place":"place-properties","postcss-pseudo-class-any-link":"any-link-pseudo-class","postcss-replace-overflow-wrap":"overflow-wrap-property","postcss-selector-not":"not-pseudo-class","postcss-system-ui-font-family":"system-ui-font-family"},ss=(()=>{const s={};for(const[e,o]of Object.entries(Z))s[o]=e;return s})(),es=new Map([["all-property",$],["any-link-pseudo-class",_],["blank-pseudo-class",i],["break-properties",E],["case-insensitive-attributes",r],["clamp",T],["color-functional-notation",n],["custom-media-queries",p],["custom-properties",u],["custom-selectors",l],["dir-pseudo-class",m],["display-two-values",U],["double-position-gradients",f],["environment-variables",d],["focus-visible-pseudo-class",b],["focus-within-pseudo-class",g],["font-format-keywords",B],["font-variant-property",h],["gap-properties",y],["hwb-function",F],["has-pseudo-class",w],["hexadecimal-alpha-notation",c],["image-set-function",v],["is-pseudo-class",A],["lab-function",k],["logical-properties-and-values",O],["media-query-ranges",S],["nesting-rules",j],["not-pseudo-class",R],["opacity-percentage",N],["overflow-property",x],["overflow-wrap-property",q],["place-properties",P],["prefers-color-scheme-query",M],["rebeccapurple-color",a],["system-ui-font-family",H]]);function os(s,e){let o="unknown",t=1/0;for(let r=0;r<e.length;r++){const i=ts(s,e[r]);i<t&&(t=i,o=e[r])}return{mostSimilar:o,distance:t}}function ts(s,e){if(!s.length)return e.length;if(!e.length)return s.length;const o=[];for(let t=0;t<=e.length;t++){o[t]=[t];for(let r=1;r<=s.length;r++)o[t][r]=0===t?r:Math.min(o[t-1][r]+1,o[t][r-1]+1,o[t-1][r-1]+(s[r-1]===e[t-1]?0:1))}return o[e.length][s.length]}const rs=[];function is(s){rs.push(s)}function ns(){rs.length=0}const cs={"blank-pseudo-class":"https://github.com/csstools/postcss-plugins/blob/main/plugins/css-blank-pseudo/README-BROWSER.md","focus-visible-pseudo-class":"https://github.com/WICG/focus-visible","focus-within-pseudo-class":"https://github.com/jsxtools/focus-within/blob/master/README-BROWSER.md","has-pseudo-class":"https://github.com/csstools/postcss-plugins/blob/main/plugins/css-has-pseudo/README-BROWSER.md","prefers-color-scheme-query":"https://github.com/csstools/postcss-plugins/blob/main/plugins/css-prefers-color-scheme/README-BROWSER.md"},as=["blank-pseudo-class","focus-visible-pseudo-class","focus-within-pseudo-class","has-pseudo-class","prefers-color-scheme-query"];function ps(s,e){if(!s)return!1;if("string"==typeof s)return!0;if(Array.isArray(s)){for(let o=0;o<s.length;o++){if("string"==typeof s[o])return!0;if(s[o]&&e in Object(s[o]))return!0}return!1}return e in Object(s)}function us(s,e,o){return Math.max(s,Math.min(e,o))}const ls=Symbol("insertBefore"),ms=Symbol("insertAfter"),fs=Symbol("insertOrder"),ds=Symbol("plugin");function bs(s,e,o){if("insertBefore"!==o&&"insertAfter"!==o)return[];const t="insertBefore"===o?ls:ms,r=[];for(const o in e){if(!Object.hasOwnProperty.call(e,o))continue;if(!s.find((s=>s.id===o)))continue;let i=e[o];Array.isArray(i)||(i=[i]);for(let s=0;s<i.length;s++)r.push({id:o,[ds]:i[s],[fs]:s,[t]:!0})}return r}var gs=["custom-media-queries","custom-properties","environment-variables","image-set-function","media-query-ranges","prefers-color-scheme-query","nesting-rules","custom-selectors","any-link-pseudo-class","case-insensitive-attributes","focus-visible-pseudo-class","focus-within-pseudo-class","not-pseudo-class","logical-properties-and-values","dir-pseudo-class","all-property","color-functional-notation","double-position-gradients","hexadecimal-alpha-notation","hwb-function","lab-function","rebeccapurple-color","blank-pseudo-class","break-properties","font-variant-property","is-pseudo-class","has-pseudo-class","gap-properties","overflow-property","overflow-wrap-property","place-properties","system-ui-font-family"];function hs(s,e,o){return s.concat(bs(s,e,"insertBefore"),bs(s,o,"insertAfter")).filter((s=>function(s){return!!s[ls]||!!s[ms]||!!es.has(s.id)}(s))).sort(((s,e)=>function(s,e){return s.id===e.id?s[ls]&&e[ls]||s[ms]&&e[ms]?us(-1,s[fs]-e[fs],1):s[ls]||e[ms]?-1:s[ms]||e[ls]?1:0:us(-1,gs.indexOf(s.id)-gs.indexOf(e.id),1)}(s,e)))}const ys=["ie","edge","firefox","chrome","safari","opera","ios_saf","android","op_mob","and_chr","and_ff","and_uc","samsung","and_qq","baidu","kaios"];function ws(s){if(!s)return[];if(!("browser_support"in s))return["> 0%"];const e=[];return ys.forEach((o=>{const t=s.browser_support[o];"string"==typeof t&&/^[0-9|.]+$/.test(t)?e.push(`${o} < ${s.browser_support[o]}`):e.push(`${o} >= 1`)})),e}function vs(s,e,o){const t=W(s,{ignoreUnknownVersions:!0});switch(e.id){case"is-pseudo-class":return{onComplexSelector:"warning"};case"nesting-rules":if(function(s,e){const o=ws(s);if(e.some((s=>W(o,{ignoreUnknownVersions:!0}).some((e=>e===s)))))return!0;return!1}(o.find((s=>"is-pseudo-class"===s.id)),t))return is('Disabling :is on "nesting-rules" due to lack of browser support.'),{noIsPseudoSelector:!0};return{};case"any-link-pseudo-class":if(t.find((s=>s.startsWith("ie ")||s.startsWith("edge "))))return is('Adding area[href] fallbacks for ":any-link" support in Edge and IE.'),{subFeatures:{areaHrefNeedsFixing:!0}};return{};default:return{}}}function $s(s,e,o){const t=Object(e.features),r=!("enableClientSidePolyfills"in e)||e.enableClientSidePolyfills,i=Object(e.insertBefore),n=Object(e.insertAfter),c=e.browsers,a=us(0,function(s){const e=parseInt(s,10);return Number.isNaN(e)?0:e}(e.minimumVendorImplementations),3);ns(),a>0&&is(`Using features with ${a} or more vendor implementations`);const p=function(s){let e=2;if(void 0===s.stage)return is(`Using features from Stage ${e} (default)`),e;if(!1===s.stage)e=5;else{let o=parseInt(s.stage,10);Number.isNaN(o)&&(o=0),e=us(0,o,5)}return is(5===e?'Stage has been disabled, features will be handled via the "features" option.':`Using features from Stage ${e}`),e}(e);2===p&&o&&!1===o.preserve&&(s=JSON.parse(JSON.stringify(s))).forEach((s=>{("blank-pseudo-class"===s.id||"prefers-color-scheme-query"===s.id)&&(s.stage=1)}));const u=hs(s,i,n).map((s=>function(s){const e=ws(s);if(s[ls]||s[ms]){let o=s.id;return o=s.insertBefore?`before-${o}`:`after-${o}`,{browsers:e,vendors_implementations:s.vendors_implementations,plugin:s[ds],id:o,stage:6}}return{browsers:e,vendors_implementations:s.vendors_implementations,plugin:es.get(s.id),id:s.id,stage:s.stage}}(s))).filter((s=>0===a||(!(!s[ls]&&!s[ms])||(a<=s.vendors_implementations||(is(`  ${s.id} with ${s.vendors_implementations} vendor implementations has been disabled`),!1))))).filter((s=>{const e=s.stage>=p,o=r||!as.includes(s.id),i=!1===t[s.id],n=t[s.id]?t[s.id]:e&&o;return i?is(`  ${s.id} has been disabled by options`):e?o||is(`  ${s.id} has been disabled by "enableClientSidePolyfills: false".`):is(n?`  ${s.id} has been enabled by options`:`  ${s.id} with stage ${s.stage} has been disabled`),n})).map((e=>function(s,e,o,t,r){let i,n;return i=vs(e,t,s),!0===o[t.id]?r&&(i=Object.assign({},i,r)):i=r?Object.assign({},i,r,o[t.id]):Object.assign({},i,o[t.id]),n=t.plugin.postcss?t.plugin(i):t.plugin,{browsers:t.browsers,vendors_implementations:t.vendors_implementations,plugin:n,pluginOptions:i,id:t.id}}(s,c,t,e,o))),l=W(c,{ignoreUnknownVersions:!0});return u.filter((s=>{if(s.id in t)return t[s.id];if(function(s){if("importFrom"in Object(s.pluginOptions))switch(s.id){case"custom-media-queries":if(ps(s.pluginOptions.importFrom,"customMedia"))return!0;break;case"custom-properties":if(ps(s.pluginOptions.importFrom,"customProperties"))return!0;break;case"environment-variables":if(ps(s.pluginOptions.importFrom,"environmentVariables"))return!0;break;case"custom-selectors":if(ps(s.pluginOptions.importFrom,"customSelectors"))return!0}if("exportTo"in Object(s.pluginOptions))switch(s.id){case"custom-media-queries":if(ps(s.pluginOptions.exportTo,"customMedia"))return!0;break;case"custom-properties":if(ps(s.pluginOptions.exportTo,"customProperties"))return!0;break;case"environment-variables":if(ps(s.pluginOptions.exportTo,"environmentVariables"))return!0;break;case"custom-selectors":if(ps(s.pluginOptions.exportTo,"customSelectors"))return!0}return!1}(s))return!0;const e=W(s.browsers,{ignoreUnknownVersions:!0}),o=l.some((s=>e.some((e=>e===s))));return o||is(`${s.id} disabled due to browser support`),o}))}const ks=o=>{const t=Object(o),r=Object.keys(Object(t.features)),i=t.browsers,n=function(s){if("importFrom"in s||"exportTo"in s||"preserve"in s){const e={};return"importFrom"in s&&(e.importFrom=s.importFrom),"exportTo"in s&&(e.exportTo={customMedia:{},customProperties:{},customSelectors:{}}),"preserve"in s&&(e.preserve=s.preserve),e}return!1}(t),c=$s(e,t,n),a=c.map((s=>s.plugin));!1!==t.autoprefixer&&a.push(s(Object.assign({overrideBrowserslist:i},t.autoprefixer))),function(s,e){if(e.debug){is("Enabling the following feature(s):");const e=[];s.forEach((s=>{s.id.startsWith("before")||s.id.startsWith("after")?is(`  ${s.id} (injected via options)`):is(`  ${s.id}`),void 0!==cs[s.id]&&e.push(s.id)})),e.length&&(is("These feature(s) need a browser library to work:"),e.forEach((s=>is(` ${s}: ${cs[s]}`))))}}(c,t);const p=()=>({postcssPlugin:"postcss-preset-env",OnceExit:function(s,{result:e}){!function(s,e,o){const t=Object.keys(ss),r=Object.keys(Z);s.forEach((s=>{if(t.includes(s))return;const i=os(s,t),n=os(s,r);i.distance<n.distance?e.warn(o,`Unknown feature: "${s}" did you mean: "${i.mostSimilar}"`):e.warn(o,`Unknown feature: "${s}" did you mean: "${Z[n.mostSimilar]}"`)}))}(r,s,e),t.debug&&function(s){s&&rs.forEach((e=>s.warn(e))),ns()}(e),ns(),t.exportTo&&D(n.exportTo,o.exportTo)}});return p.postcss=!0,{postcssPlugin:"postcss-preset-env",plugins:[...a,p()]}};ks.postcss=!0;export{ks as default};
